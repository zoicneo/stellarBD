<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StellarBirthdays - Your Cosmic Connection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        /* Apply Inter font globally */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000; /* Black fallback */
            margin: 0;
            overflow-x: hidden;
        }

        /* Style for the 3D canvas */
        #starfield-canvas {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        /* Ensure main content container is positioned above the canvas */
        .main-content-container {
             position: relative;
             z-index: 1;
             padding: 2rem 1rem;
        }

        /* Custom scrollbar - Dark theme */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; } /* gray-800 */
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; } /* gray-600 */
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; } /* gray-500 */

        /* Style for the date input placeholder icon on dark bg*/
         input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0.8);
            cursor: pointer;
         }

        /* Basic transition for hover effects */
        button, a, [data-star-name] { transition: all 0.2s ease-in-out; }

        /* Ensure hidden sections don't affect layout */
        .hidden { display: none; }

        /* Fade-in animation */
        @keyframes fadeIn {
            '0%': { opacity: 0; transform: translateY(10px); }
            '100%': { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }

        /* Styles for disabled pagination buttons */
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
    <script>
        // Tailwind Customizations (Optional)
        tailwind.config = {
            theme: {
                extend: {
                     colors: {
                        'cosmic-blue': '#312e81', 'stellar-purple': '#79449a',
                        'light-nebula': '#e0e7ff', 'dark-space': '#111827',
                    },
                }
            }
        }
    </script>
</head>
<body class="text-gray-200 min-h-screen flex flex-col items-center">

    <canvas id="starfield-canvas"></canvas>

    <div class="w-full max-w-3xl mx-auto main-content-container">

        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 via-pink-500 to-red-500 mb-2">
                StellarBirthdays
            </h1>
            <p class="text-lg text-indigo-300">Celebrate your cosmic connection to the stars!</p>
        </header>

        <section id="input-section" class="bg-gray-900/50 backdrop-blur-md p-6 opacity-75 rounded-lg shadow-lg mb-8 border border-gray-700/50">
            <h2 class="text-2xl font-semibold mb-4 text-center text-indigo-300">Enter Your Birth Date</h2>
            <div class="flex flex-col sm:flex-row items-center justify-center opacity-90 gap-4">
                <label for="birthdate" class="sr-only">Your Birth Date:</label>
                <input type="date" id="birthdate" name="birthdate" aria-label="Your Birth Date"
                       class="bg-gray-700 border border-gray-600 text-gray-100 rounded-md px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:outline-none focus:border-indigo-500 placeholder-gray-400 w-full sm:w-auto flex-grow">
                <button id="calculate-button"
                        class="w-full sm:w-auto bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white font-semibold py-2 px-6 rounded-md shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500">
                    Calculate Stellar Birthdays
                </button>
            </div>
            <p id="input-error" class="text-red-400 text-sm mt-3 text-center h-4"></p>
        </section>

        <section id="results-section" class="mb-8 opacity-0 hidden" aria-live="polite">
             <h2 class="text-2xl font-semibold mb-4 text-indigo-300">Upcoming Stellar Birthdays</h2>
            <div id="results-list" class="space-y-4 opacity-75">
                </div>
             <p id="no-results" class="text-center text-gray-500 mt-4 hidden">No upcoming Stellar Birthdays found within 150 light-years with apparent magnitude < 6.0.</p>

             <div id="pagination-controls" class="mt-6 flex justify-between items-center hidden">
                 <button id="prev-button" class="bg-gray-600 hover:bg-gray-500 text-white font-semibold py-2 px-4 rounded-md shadow disabled:opacity-50 disabled:cursor-not-allowed">
                     &larr; Previous
                 </button>
                 <span id="page-info" class="text-sm text-gray-400">Page 1 of 1</span>
                 <button id="next-button" class="bg-gray-600 hover:bg-gray-500 text-white font-semibold py-2 px-4 rounded-md shadow opacity-0 disabled:cursor-not-allowed">
                     Next &rarr;
                 </button>
             </div>
        </section>

        <section id="star-details-section" class="fixed inset-0 bg-black/80 backdrop-blur-md flex items-center justify-center p-4 z-50 hidden" aria-modal="true" role="dialog">
             <div class="bg-gray-800/50 backdrop-blur-sm text-gray-200 p-6 rounded-lg shadow-xl max-w-lg w-full border border-gray-600/50 relative max-h-[80vh] overflow-y-auto animate-fade-in"> 
                 <button id="close-details-button" class="absolute top-3 right-3 text-gray-400 hover:text-white" aria-label="Close star details">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                 </button>
                 <h3 id="details-star-name" class="text-3xl font-bold mb-4 text-indigo-300">Star Name</h3>
                 <div class="space-y-3 text-sm text-gray-300">
                    <p><strong>Scientific Designation:</strong> <span id="details-designation">-</span></p>
                     <p><strong>Distance:</strong> <span id="details-distance-ly">-</span> light-years (<span id="details-distance-pc">-</span> parsecs)</p>
                     <p><strong>Constellation:</strong> <span id="details-constellation">-</span></p>
                     <p><strong>Spectral Type:</strong> <span id="details-spectral">-</span></p>
                     <p><strong>Apparent Magnitude:</strong> <span id="details-app-mag">-</span></p>
                     <p><strong>Absolute Magnitude:</strong> <span id="details-abs-mag">-</span></p>
                     <p><strong>Description:</strong> <span id="details-description">-</span></p>
                     <p><strong>Mythology:</strong> <span id="details-mythology">-</span></p>
                     <p><strong>Known Exoplanets:</strong> <span id="details-exoplanets">-</span></p>
                     <p><strong>External Link:</strong> <a id="details-link" href="#" target="_blank" rel="noopener noreferrer" class="text-purple-400 hover:text-purple-300 underline">Learn More</a></p>
                 </div>
            </div>
        </section>

        <section id="personalized-content-section" class="bg-gray-900/50 backdrop-blur-md p-6 rounded-lg shadow-lg mt-8 border border-gray-700/50 opacity-0 hidden" aria-live="polite"> 
             <h2 class="text-2xl font-semibold mb-4 text-indigo-300">Your Next Cosmic Milestone</h2>
             <div id="personalized-content" class="space-y-4 text-gray-300 opacity-75">
             </div>
             <div class="mt-6 text-center">
                 <p class="text-indigo-300">Enjoying StellarBirthdays?</p>
                 <a href="#" id="mobile-app-link" class="inline-block mt-2 bg-gradient-to-r from-teal-500 to-cyan-500 hover:from-teal-600 hover:to-cyan-600 text-white font-semibold py-2 px-5 rounded-md shadow hover:shadow-lg">
                     Get the StellarBirthdays Mobile App!
                 </a>
             </div>
        </section>

        <footer class="text-center mt-12 text-gray-400 text-sm">
            <p>&copy; <span id="current-year"></span> StellarBirthdays. All rights reserved.</p>
            <p>Star data sourced from public astronomical catalogs (sample). Calculations are approximate.</p>
        </footer>

    </div>

    <script>
        // --- DOM Elements ---
        const birthdateInput = document.getElementById('birthdate');
        const calculateButton = document.getElementById('calculate-button');
        const inputError = document.getElementById('input-error');
        const resultsSection = document.getElementById('results-section');
        const resultsList = document.getElementById('results-list');
        const noResultsMessage = document.getElementById('no-results');
        const starDetailsSection = document.getElementById('star-details-section');
        const closeDetailsButton = document.getElementById('close-details-button');
        const personalizedContentSection = document.getElementById('personalized-content-section');
        const personalizedContent = document.getElementById('personalized-content');
        const currentYearSpan = document.getElementById('current-year');
        const paginationControls = document.getElementById('pagination-controls');
        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');
        const pageInfo = document.getElementById('page-info');

        // --- Constants ---
        const LIGHT_YEARS_TO_PARSECS = 1 / 3.26156;
        const DAYS_PER_YEAR = 365.2425;
        const MS_PER_DAY = 24 * 60 * 60 * 1000;
        const RESULTS_PER_PAGE = 3;

        // --- State Variables ---
        let allUpcomingBirthdays = [];
        let currentPage = 1;

        // --- Star Data (Full Expanded List Restored) ---
        const starData = [
            // Original + Expansions
            { name: "Sirius", designation: "Alpha CMa", distance_ly: 8.6, spectral: "A1Vm", app_mag: -1.46, abs_mag: 1.42, constellation: "Canis Major", description: "The brightest star in the night sky.", mythology: "Associated with dogs.", exoplanets: "Sirius B (WD).", link: "https://en.wikipedia.org/wiki/Sirius" },
            { name: "Alpha Centauri A", designation: "Alpha Cen A", distance_ly: 4.37, spectral: "G2V", app_mag: -0.01, abs_mag: 4.38, constellation: "Centaurus", description: "Closest star system.", mythology: "Centaur's foot.", exoplanets: "Candidate b.", link: "https://en.wikipedia.org/wiki/Alpha_Centauri" },
            { name: "Alpha Centauri B", designation: "Alpha Cen B", distance_ly: 4.37, spectral: "K1V", app_mag: 1.34, abs_mag: 5.71, constellation: "Centaurus", description: "Companion to Alpha Cen A.", mythology: "Shares mythology.", exoplanets: "Candidate c.", link: "https://en.wikipedia.org/wiki/Alpha_Centauri" },
            { name: "Arcturus", designation: "Alpha Boo", distance_ly: 36.7, spectral: "K0III", app_mag: -0.05, abs_mag: -0.30, constellation: "Boötes", description: "Brightest northern star.", mythology: "'Guardian of the Bear'.", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Arcturus" },
            { name: "Vega", designation: "Alpha Lyr", distance_ly: 25.0, spectral: "A0Va", app_mag: 0.03, abs_mag: 0.58, constellation: "Lyra", description: "Part of Summer Triangle.", mythology: "Lyre of Orpheus.", exoplanets: "Candidate b.", link: "https://en.wikipedia.org/wiki/Vega" },
            { name: "Capella", designation: "Alpha Aur", distance_ly: 42.9, spectral: "G1III+G8III", app_mag: 0.08, abs_mag: -0.48, constellation: "Auriga", description: "Multiple star system.", mythology: "Associated with goats.", exoplanets: "None in close system.", link: "https://en.wikipedia.org/wiki/Capella" },
            { name: "Procyon", designation: "Alpha CMi", distance_ly: 11.46, spectral: "F5 IV-V", app_mag: 0.34, abs_mag: 2.65, constellation: "Canis Minor", description: "Part of Winter Triangle.", mythology: "'Before the dog'.", exoplanets: "Procyon B (WD).", link: "https://en.wikipedia.org/wiki/Procyon" },
            { name: "Altair", designation: "Alpha Aql", distance_ly: 16.7, spectral: "A7Vn", app_mag: 0.76, abs_mag: 2.21, constellation: "Aquila", description: "Part of Summer Triangle.", mythology: "The eagle.", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Altair" },
            { name: "Aldebaran", designation: "Alpha Tau", distance_ly: 65.3, spectral: "K5+ III", app_mag: 0.85, abs_mag: -0.63, constellation: "Taurus", description: "Orange giant, 'Eye of the Bull'.", mythology: "Follower of Pleiades.", exoplanets: "Candidate b.", link: "https://en.wikipedia.org/wiki/Aldebaran" },
            { name: "Pollux", designation: "Beta Gem", distance_ly: 33.78, spectral: "K0 III", app_mag: 1.14, abs_mag: 1.09, constellation: "Gemini", description: "Orange giant.", mythology: "One of the twins.", exoplanets: "Confirmed: Pollux b.", link: "https://en.wikipedia.org/wiki/Pollux_(star)" },
            { name: "Fomalhaut", designation: "Alpha PsA", distance_ly: 25.1, spectral: "A3V", app_mag: 1.16, abs_mag: 1.72, constellation: "Piscis Austrinus", description: "'Lonely Star of Autumn'.", mythology: "'Mouth of the fish'.", exoplanets: "Confirmed: Fomalhaut b.", link: "https://en.wikipedia.org/wiki/Fomalhaut" },
            { name: "Regulus", designation: "Alpha Leo", distance_ly: 79.3, spectral: "B8IVn", app_mag: 1.36, abs_mag: -0.52, constellation: "Leo", description: "Brightest star in Leo.", mythology: "'Little King'.", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Regulus" },
            { name: "Castor", designation: "Alpha Gem", distance_ly: 51, spectral: "A1V+A2Vm", app_mag: 1.58, abs_mag: 0.59, constellation: "Gemini", description: "Multiple star system.", mythology: "One of the twins.", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Castor_(star)" },
            { name: "Denebola", designation: "Beta Leo", distance_ly: 35.9, spectral: "A3Va", app_mag: 2.14, abs_mag: 1.92, constellation: "Leo", description: "Second brightest in Leo.", mythology: "'Tail of the Lion'.", exoplanets: "Debris disk.", link: "https://en.wikipedia.org/wiki/Denebola" },
            { name: "Menkalinan", designation: "Beta Aur", distance_ly: 81.1, spectral: "A1mIV+A1mIV", app_mag: 1.90, abs_mag: -0.11, constellation: "Auriga", description: "Eclipsing binary.", mythology: "'Shoulder of Charioteer'.", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Beta_Aurigae" },
            { name: "Alphecca (Gemma)", designation: "Alpha CrB", distance_ly: 75, spectral: "A0V+G5V", app_mag: 2.22, abs_mag: 0.42, constellation: "Corona Borealis", description: "Eclipsing binary.", mythology: "'The Broken Ring'.", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Alpha_Coronae_Borealis" },
            { name: "Zosma", designation: "Delta Leo", distance_ly: 57.7, spectral: "A4V", app_mag: 2.56, abs_mag: 1.32, constellation: "Leo", description: "Rapidly rotating star.", mythology: "'Girdle'.", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Delta_Leonis" },
            { name: "Rasalhague", designation: "Alpha Oph", distance_ly: 48.6, spectral: "A5III", app_mag: 2.07, abs_mag: 1.22, constellation: "Ophiuchus", description: "Brightest star in Ophiuchus.", mythology: "'Head of Serpent Charmer'.", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Alpha_Ophiuchi" },
            { name: "Iota Centauri", designation: "Iota Cen", distance_ly: 58.6, spectral: "A2V", app_mag: 2.73, abs_mag: 1.46, constellation: "Centaurus", description: "White A-type star.", mythology: "-", exoplanets: "Debris disk.", link: "https://en.wikipedia.org/wiki/Iota_Centauri" },
            { name: "Beta Trianguli Australis", designation: "Beta TrA", distance_ly: 40.1, spectral: "F1V", app_mag: 2.85, abs_mag: 2.08, constellation: "Triangulum Australe", description: "Brightest in constellation.", mythology: "-", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Beta_Trianguli_Australis" },
            { name: "Algol", designation: "Beta Per", distance_ly: 90, spectral: "B8V+K0IV+A5V", app_mag: 2.12, abs_mag: -0.18, constellation: "Perseus", description: "Eclipsing binary.", mythology: "'Demon Star'.", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Algol" },
            { name: "Gamma Leonis (Algieba)", designation: "Gamma Leo", distance_ly: 130, spectral: "K0III+G7III", app_mag: 2.01, abs_mag: -0.93, constellation: "Leo", description: "Binary star system.", mythology: "'The Forehead'.", exoplanets: "Confirmed: Gamma Leo b.", link: "https://en.wikipedia.org/wiki/Algieba" },
            { name: "Mu Velorum", designation: "Mu Vel", distance_ly: 117, spectral: "G5III+G2V", app_mag: 2.69, abs_mag: -0.04, constellation: "Vela", description: "Binary star system.", mythology: "-", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Mu_Velorum" },
            { name: "Epsilon Eridani", designation: "HD 22049", distance_ly: 10.5, spectral: "K2V", app_mag: 3.73, abs_mag: 6.19, constellation: "Eridanus", description: "Nearby Sun-like star.", mythology: "Part of river Eridanus.", exoplanets: "Confirmed: Eps Eri b.", link: "https://en.wikipedia.org/wiki/Epsilon_Eridani" },
            { name: "Tau Ceti", designation: "HD 10700", distance_ly: 11.9, spectral: "G8.5V", app_mag: 3.50, abs_mag: 5.69, constellation: "Cetus", description: "Nearby Sun-like star.", mythology: "Part of whale Cetus.", exoplanets: "4 candidates.", link: "https://en.wikipedia.org/wiki/Tau_Ceti" },
            { name: "61 Cygni A", designation: "HD 201091", distance_ly: 11.41, spectral: "K5V", app_mag: 5.20, abs_mag: 7.50, constellation: "Cygnus", description: "Binary system.", mythology: "Large proper motion.", exoplanets: "Disputed candidates.", link: "https://en.wikipedia.org/wiki/61_Cygni" },
            // Second Expansion
            { name: "Achernar", designation: "Alpha Eri", distance_ly: 139, spectral: "B6Vep", app_mag: 0.46, abs_mag: -2.77, constellation: "Eridanus", description: "Very oblate rapidly rotating star.", mythology: "'End of the river'.", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Achernar" },
            { name: "Elnath", designation: "Beta Tau", distance_ly: 134, spectral: "B7III", app_mag: 1.65, abs_mag: -1.37, constellation: "Taurus", description: "Second brightest in Taurus.", mythology: "'The Butting One'.", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Elnath" },
            { name: "Miaplacidus", designation: "Beta Car", distance_ly: 113, spectral: "A1III", app_mag: 1.69, abs_mag: -0.99, constellation: "Carina", description: "Second brightest in Carina.", mythology: "'Placid waters'.", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Miaplacidus" },
            { name: "Alnair", designation: "Alpha Gru", distance_ly: 101, spectral: "B6V", app_mag: 1.74, abs_mag: -0.73, constellation: "Grus", description: "Brightest star in Grus.", mythology: "'The bright one'.", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Alnair" },
            { name: "Alioth", designation: "Epsilon UMa", distance_ly: 82.6, spectral: "A1III-IVpkB9", app_mag: 1.77, abs_mag: -0.21, constellation: "Ursa Major", description: "Brightest star in Ursa Major.", mythology: "Part of Big Dipper.", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Alioth" },
            { name: "Dubhe", designation: "Alpha UMa", distance_ly: 123, spectral: "K0III+F0V", app_mag: 1.79, abs_mag: -1.10, constellation: "Ursa Major", description: "Pointer star in Big Dipper.", mythology: "'The Bear'.", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Dubhe" },
            { name: "Kaus Australis", designation: "Epsilon Sgr", distance_ly: 143, spectral: "B9.5III", app_mag: 1.85, abs_mag: -1.44, constellation: "Sagittarius", description: "Brightest star in Sagittarius.", mythology: "'Southern part of the bow'.", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Kaus_Australis" },
            { name: "Alkaid", designation: "Eta UMa", distance_ly: 104, spectral: "B3V", app_mag: 1.86, abs_mag: -0.60, constellation: "Ursa Major", description: "End star of Big Dipper handle.", mythology: "'Leader of the mourning daughters'.", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Alkaid" },
            { name: "Alhena", designation: "Gamma Gem", distance_ly: 109, spectral: "A1.5IV+", app_mag: 1.93, abs_mag: -0.60, constellation: "Gemini", description: "Third brightest in Gemini.", mythology: "'The brand' (on camel's neck).", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Alhena" },
            { name: "Alsephina", designation: "Delta Vel", distance_ly: 80.6, spectral: "A1Va(n)", app_mag: 1.96, abs_mag: 0.01, constellation: "Vela", description: "Multiple star system.", mythology: "'The ship'.", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Delta_Velorum" },
            { name: "Hamal", designation: "Alpha Ari", distance_ly: 65.8, spectral: "K1IIIb", app_mag: 2.00, abs_mag: 0.48, constellation: "Aries", description: "Brightest star in Aries.", mythology: "'Head of the ram'.", exoplanets: "Confirmed: Alpha Arietis b.", link: "https://en.wikipedia.org/wiki/Hamal" },
            { name: "Diphda", designation: "Beta Cet", distance_ly: 96.3, spectral: "K0III", app_mag: 2.02, abs_mag: -0.30, constellation: "Cetus", description: "Brightest star in Cetus.", mythology: "'Second frog'.", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Diphda" },
            { name: "Mizar", designation: "Zeta UMa", distance_ly: 82.9, spectral: "A2Vp+A2Vp", app_mag: 2.04, abs_mag: -0.21, constellation: "Ursa Major", description: "Famous double star with Alcor.", mythology: "Part of Big Dipper.", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Mizar_and_Alcor" },
            { name: "Menkent", designation: "Theta Cen", distance_ly: 59.2, spectral: "K0III", app_mag: 2.06, abs_mag: 0.70, constellation: "Centaurus", description: "Orange giant.", mythology: "'Shoulder of the Centaur'.", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Theta_Centauri" },
            { name: "Alpheratz", designation: "Alpha And", distance_ly: 97, spectral: "B8IVpMnHg", app_mag: 2.06, abs_mag: -0.30, constellation: "Andromeda", description: "Binary star, formerly Delta Pegasi.", mythology: "'Horse's navel'.", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Alpheratz" },
            { name: "Kochab", designation: "Beta UMi", distance_ly: 130.9, spectral: "K4III", app_mag: 2.08, abs_mag: -0.87, constellation: "Ursa Minor", description: "Second brightest in Ursa Minor.", mythology: "'Star'.", exoplanets: "Confirmed: Beta Ursae Minoris b.", link: "https://en.wikipedia.org/wiki/Kochab" },
            { name: "Gacrux", designation: "Gamma Cru", distance_ly: 88.6, spectral: "M3.5III", app_mag: 1.64, abs_mag: -0.56, constellation: "Crux", description: "Red giant, top star of Southern Cross.", mythology: "-", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Gacrux" },
            { name: "Beta Hydri", designation: "Beta Hyi", distance_ly: 24.3, spectral: "G2IV", app_mag: 2.80, abs_mag: 3.45, constellation: "Hydrus", description: "Nearest subgiant star.", mythology: "-", exoplanets: "Confirmed: Beta Hydri b.", link: "https://en.wikipedia.org/wiki/Beta_Hydri" },
            { name: "Zeta Tucanae", designation: "Zeta Tuc", distance_ly: 28.0, spectral: "F9.5V", app_mag: 4.23, abs_mag: 4.56, constellation: "Tucana", description: "Sun-like star.", mythology: "-", exoplanets: "Debris disk.", link: "https://en.wikipedia.org/wiki/Zeta_Tucanae" },
            { name: "Eta Cassiopeiae", designation: "Eta Cas", distance_ly: 19.4, spectral: "G0V+K7V", app_mag: 3.44, abs_mag: 4.59, constellation: "Cassiopeia", description: "Binary star system.", mythology: "-", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Eta_Cassiopeiae" },
            { name: "Chi¹ Orionis", designation: "Chi¹ Ori", distance_ly: 28.3, spectral: "G0V", app_mag: 4.39, abs_mag: 4.70, constellation: "Orion", description: "Sun-like star, binary.", mythology: "-", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Chi1_Orionis" },
            { name: "47 Ursae Majoris", designation: "47 UMa", distance_ly: 45.9, spectral: "G1V", app_mag: 5.03, abs_mag: 4.29, constellation: "Ursa Major", description: "Sun-like star with planets.", mythology: "-", exoplanets: "Confirmed: 47 UMa b, c, d.", link: "https://en.wikipedia.org/wiki/47_Ursae_Majoris" },
            { name: "Delta Pavonis", designation: "Delta Pav", distance_ly: 19.9, spectral: "G8IV", app_mag: 3.56, abs_mag: 4.62, constellation: "Pavo", description: "Nearby subgiant star.", mythology: "-", exoplanets: "Candidate.", link: "https://en.wikipedia.org/wiki/Delta_Pavonis" },
            // Examples beyond 150 ly (will be filtered out but test filter)
            { name: "Delta Serpentis", designation: "Delta Ser", distance_ly: 210, spectral: "F0IV", app_mag: 3.80, abs_mag: -0.29, constellation: "Serpens", description: "Subgiant star.", mythology: "-", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Delta_Serpentis" },
            { name: "Zeta Ophiuchi", designation: "Zeta Oph", distance_ly: 460, spectral: "O9.5V", app_mag: 2.57, abs_mag: -3.20, constellation: "Ophiuchus", description: "Very hot blue star.", mythology: "-", exoplanets: "None confirmed.", link: "https://en.wikipedia.org/wiki/Zeta_Ophiuchi" },
        ];

        // --- Filtered Star Data ---
        const filteredStarData = starData.filter(star =>
            star.distance_ly <= 150 && star.app_mag < 6.0
        );

        // --- Initial Setup ---
        currentYearSpan.textContent = new Date().getFullYear();
        birthdateInput.max = new Date().toISOString().split("T")[0];

        // --- Event Listeners ---
        // [App Logic Listeners remain unchanged]
        calculateButton.addEventListener('click', handleCalculation);
        closeDetailsButton.addEventListener('click', hideStarDetails);
        resultsList.addEventListener('click', handleResultClick);
        starDetailsSection.addEventListener('click', (event) => {
            if (event.target === starDetailsSection) hideStarDetails();
        });
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && !starDetailsSection.classList.contains('hidden')) {
                hideStarDetails();
            }
        });
        prevButton.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                displayCurrentPage();
            }
        });
        nextButton.addEventListener('click', () => {
            const totalPages = Math.ceil(allUpcomingBirthdays.length / RESULTS_PER_PAGE);
            if (currentPage < totalPages) {
                currentPage++;
                displayCurrentPage();
            }
        });


        // --- Helper Functions ---
        // [App Logic Helper Functions remain unchanged]
        function parseDateUTC(dateString) {
            const parts = dateString.split('-');
            if (parts.length !== 3) return null;
            const year = parseInt(parts[0], 10);
            const month = parseInt(parts[1], 10) - 1;
            const day = parseInt(parts[2], 10);
            if (isNaN(year) || isNaN(month) || isNaN(day)) return null;
            const date = new Date(Date.UTC(year, month, day));
            if (date.getUTCFullYear() !== year || date.getUTCMonth() !== month || date.getUTCDate() !== day) {
                return null;
            }
            return date;
         }
        function addYearsToDate(startDateUTC, yearsToAdd) {
            const daysToAdd = yearsToAdd * DAYS_PER_YEAR;
            const futureTime = startDateUTC.getTime() + daysToAdd * MS_PER_DAY;
            return new Date(futureTime);
         }
        function formatDate(dateUTC) {
            return dateUTC.toLocaleDateString('en-US', {
                year: 'numeric', month: 'long', day: 'numeric', timeZone: 'UTC'
            });
         }
        function convertLightYearsToParsecs(lightYears) {
            if (lightYears == null) return '-';
            return (lightYears * LIGHT_YEARS_TO_PARSECS).toFixed(2);
         }
        function getOrdinalSuffix(n) {
             if (n == null) return '';
            const s = ["th", "st", "nd", "rd"];
            const v = n % 100;
            return s[(v - 20) % 10] || s[v] || s[0];
         }

        // --- Core Calculation Logic ---
        // [App Logic Core Calculation (handleCalculation) remains unchanged]
        function handleCalculation() {
            inputError.textContent = "";
            resultsList.innerHTML = ""; // Clear results list
            personalizedContent.innerHTML = "";
            resultsSection.classList.add('opacity-0', 'hidden');
            personalizedContentSection.classList.add('opacity-0', 'hidden');
            noResultsMessage.classList.add('hidden');
            paginationControls.classList.add('hidden'); // Hide pagination initially

            const birthDateString = birthdateInput.value;
            if (!birthDateString) {
                inputError.textContent = "Please enter your birth date."; return;
            }
            const birthDateUTC = parseDateUTC(birthDateString);
            if (!birthDateUTC) {
                 inputError.textContent = "Invalid date format. Please use YYYY-MM-DD."; return; // Corrected error message
            }

            const today = new Date();
            const todayUTC = new Date(Date.UTC(today.getUTCFullYear(), today.getUTCMonth(), today.getUTCDate()));

            // Calculate the full list
            allUpcomingBirthdays = []; // Reset the global list
            filteredStarData.forEach(star => {
                if (star.distance_ly == null) return;
                const lightTravelTimeYears = star.distance_ly;
                const sbdUTC = addYearsToDate(birthDateUTC, lightTravelTimeYears);
                const ageOnSBD = Math.floor(lightTravelTimeYears);
                if (sbdUTC >= todayUTC) {
                    allUpcomingBirthdays.push({ sbd: sbdUTC, star: star, age: ageOnSBD });
                }
            });

            // Sort the full list
            allUpcomingBirthdays.sort((a, b) => a.sbd.getTime() - b.sbd.getTime());

            // Reset to page 1 and display
            currentPage = 1;
            displayCurrentPage(); // Display the first page

            // Show personalized content for the very first result overall
            if (allUpcomingBirthdays.length > 0) {
                displayPersonalizedContent(allUpcomingBirthdays[0], birthDateUTC);
                personalizedContentSection.classList.remove('hidden');
                setTimeout(() => personalizedContentSection.classList.remove('opacity-0'), 0);
                personalizedContentSection.classList.add('animate-fade-in');
            } else {
                 personalizedContentSection.classList.add('hidden', 'opacity-0');
            }

            // Show results section (might show "no results" or the first page)
            resultsSection.classList.remove('hidden');
            setTimeout(() => resultsSection.classList.remove('opacity-0'), 0);
            resultsSection.classList.add('animate-fade-in');
         }

        // --- Pagination Display Logic ---
        // [App Logic Pagination (displayCurrentPage) remains unchanged]
         function displayCurrentPage() {
            resultsList.innerHTML = ''; // Clear previous page's results
            noResultsMessage.classList.add('hidden'); // Assume results exist initially

            const totalResults = allUpcomingBirthdays.length;
            const totalPages = Math.ceil(totalResults / RESULTS_PER_PAGE);

            if (totalResults === 0) {
                noResultsMessage.classList.remove('hidden');
                paginationControls.classList.add('hidden'); // Hide controls if no results
                return;
            }

            // Calculate slice indices
            const startIndex = (currentPage - 1) * RESULTS_PER_PAGE;
            const endIndex = startIndex + RESULTS_PER_PAGE;
            const birthdaysToDisplay = allUpcomingBirthdays.slice(startIndex, endIndex);

            // Display the slice
            displayResults(birthdaysToDisplay);

            // Update and show pagination controls if needed
            if (totalPages > 1) {
                pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
                prevButton.disabled = currentPage === 1;
                nextButton.disabled = currentPage === totalPages;
                paginationControls.classList.remove('hidden');
            } else {
                paginationControls.classList.add('hidden'); // Hide if only one page
            }
        }


        // --- UI Display Functions ---
        // [App Logic UI Display (displayResults, etc.) remain unchanged, except for class below]
        function displayResults(birthdays) {
             if (birthdays.length === 0 && allUpcomingBirthdays.length === 0) {
                 return;
            }

            birthdays.forEach((bday, index) => {
                const star = bday.star;
                const distancePc = convertLightYearsToParsecs(star.distance_ly);
                const formattedSBD = formatDate(bday.sbd);
                const listItem = document.createElement('div');
                // *** Adjusted opacity for result items ***
                listItem.className = "bg-gray-900/50 backdrop-blur-md p-4 rounded-lg shadow border border-gray-700/50 cursor-pointer hover:bg-gray-800/60 animate-fade-in opacity-0"; // Adjusted opacity, hover opacity
                listItem.style.animationDelay = `${index * 0.05}s`;
                listItem.dataset.starName = star.name;
                listItem.innerHTML = `
                    <p class="text-lg font-semibold text-gray-100">Stellar Birthday: <span class="text-purple-400 font-bold">${formattedSBD}</span></p>
                    <p class="text-sm text-gray-400">Star: <span class="font-medium text-indigo-300">${star.name || 'N/A'}</span> (${star.distance_ly ?? '?'} light-years / ${distancePc} parsecs)</p>
                    <p class="text-sm text-gray-400">Your Age: <span class="font-medium text-gray-200">${bday.age ?? '?'}</span></p>
                `;
                resultsList.appendChild(listItem);
                void listItem.offsetWidth; // Reflow
                listItem.classList.remove('opacity-0'); // Animate
            });
         }
        function displayPersonalizedContent(nextBirthday, birthDateUTC) {
             const star = nextBirthday.star;
            const formattedSBD = formatDate(nextBirthday.sbd);
            const formattedBirthDate = formatDate(birthDateUTC);
            let story = `
                <h3 class="text-xl font-semibold text-indigo-300">${star.name || 'This Star'}: Your Next Cosmic Milestone</h3>
                <p class="italic text-gray-400">On <span class="font-semibold text-purple-300">${formattedSBD}</span>, light that left the star <span class="font-semibold text-gray-200">${star.name || 'nearby'}</span> around the time you were born (${formattedBirthDate}) will finally complete its ${star.distance_ly ?? 'cosmic'}-light-year journey to Earth.</p>
                <p class="text-gray-300">Imagine that photon's incredible voyage across the cosmos, arriving just in time for your ${nextBirthday.age ?? 'next'}${getOrdinalSuffix(nextBirthday.age)} Stellar Birthday!</p>
                <p class="text-sm text-gray-400">${star.description ? `Known fact: ${star.description}` : ''}</p>
                ${star.mythology ? `<p class="text-sm text-gray-400">Mythology: ${star.mythology}</p>` : ''}
            `;
            personalizedContent.innerHTML = story;
         }
        function handleResultClick(event) {
             const resultItem = event.target.closest('[data-star-name]');
            if (resultItem) {
                const starName = resultItem.dataset.starName;
                if (starName) {
                    showStarDetails(starName);
                } else {
                    console.warn("Clicked item missing data-star-name attribute.");
                }
            }
         }
        function showStarDetails(starName) {
             const star = filteredStarData.find(s => s.name === starName);
            if (!star) { console.error("Star not found:", starName); return; }

            const distanceLy = star.distance_ly ?? '-';
            const distancePc = distanceLy !== '-' ? convertLightYearsToParsecs(distanceLy) : '-';

            document.getElementById('details-star-name').textContent = star.name || 'Unknown Star';
            document.getElementById('details-designation').textContent = star.designation || '-';
            document.getElementById('details-distance-ly').textContent = distanceLy;
            document.getElementById('details-distance-pc').textContent = distancePc;
            document.getElementById('details-constellation').textContent = star.constellation || '-';
            document.getElementById('details-spectral').textContent = star.spectral || '-';
            document.getElementById('details-app-mag').textContent = star.app_mag !== undefined ? star.app_mag : '-';
            document.getElementById('details-abs-mag').textContent = star.abs_mag !== undefined ? star.abs_mag : '-';
            document.getElementById('details-description').textContent = star.description || 'No description available.';
            document.getElementById('details-mythology').textContent = star.mythology || 'No mythology information available.';
            document.getElementById('details-exoplanets').textContent = star.exoplanets || 'Information not available.';

            const detailsLink = document.getElementById('details-link');
            if (star.link) {
                 detailsLink.href = star.link; detailsLink.style.display = 'inline';
            } else {
                 detailsLink.style.display = 'none';
            }

            starDetailsSection.classList.remove('hidden');
            requestAnimationFrame(() => { closeDetailsButton.focus(); });
         }
        function hideStarDetails() {
            starDetailsSection.classList.add('hidden');
         }

    </script>

    <script>
        // --- Three.js Setup ---
        let scene, camera, renderer;
        let stars; // This will hold our star particles
        let mouseX = 0, mouseY = 0; // Variables to store mouse position relative to center

        // --- Initialization ---
        function initStarfield() {
            const canvas = document.getElementById('starfield-canvas');
             if (!canvas) {
                console.error("Canvas element #starfield-canvas not found!");
                return;
            }

            // 1. Scene
            scene = new THREE.Scene();

            // 2. Camera
            camera = new THREE.PerspectiveCamera(
                60, // Field of view
                window.innerWidth / window.innerHeight, // Aspect ratio
                1, // Near clip
                1000 // Far clip
            );
            camera.position.z = 5; // Adjusted initial position

            // 3. Renderer
            renderer = new THREE.WebGLRenderer({
                canvas: canvas, // Use existing canvas
                antialias: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.setClearColor(0x000000, 1); // Black background

            // --- Create Stars ---
            const starGeometry = new THREE.BufferGeometry();
            const starCount = 10000;
            const positions = new Float32Array(starCount * 3);

            for (let i = 0; i < starCount * 3; i += 3) {
                const radius = Math.random() * 500 + 50;
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.acos((Math.random() * 2) - 1);
                positions[i]     = radius * Math.sin(phi) * Math.cos(theta); // x
                positions[i + 1] = radius * Math.sin(phi) * Math.sin(theta); // y
                positions[i + 2] = radius * Math.cos(phi);                   // z
            }
            starGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));

            const starMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.7,
                sizeAttenuation: true
            });

            stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);

            // --- Event Listeners ---
            window.addEventListener('resize', onWindowResize, false);
            document.addEventListener('mousemove', onMouseMove, false);
        }

        // --- Handle Window Resize ---
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        }

        // --- Handle Mouse Movement ---
        function onMouseMove(event) {
            const halfWidth = window.innerWidth / 2;
            const halfHeight = window.innerHeight / 2;
            mouseX = halfWidth ? (event.clientX - halfWidth) / halfWidth : 0;
            mouseY = halfHeight ? (event.clientY - halfHeight) / halfHeight : 0;
        }

        // --- Animation Loop ---
        function animateStarfield() {
            requestAnimationFrame(animateStarfield);
            if (stars) {
                 // stars.rotation.y -= 0.0001; // Optional constant rotation
                 stars.rotation.y -= mouseX * 0.0006;
                 stars.rotation.x -= mouseY * 0.0006;
            }
            renderer.render(scene, camera);
        }

        // --- Start ---
        // Use window.onload to ensure canvas and app logic script are ready
        window.onload = () => {
             // Check if the app logic script also uses window.onload and coordinate if necessary
             // Assuming app logic doesn't rely heavily on window.onload for its core setup
             initStarfield();
             animateStarfield();
        };

    </script>

</body>
</html>
